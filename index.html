<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Chemie pro 9. třídu — PSE, názvosloví, reakce</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0b1420; --bg2:#0e1a28; --card:#101f31; --muted:#a9b6c6; --text:#ecf3ff; --accent:#5ee39f; --accent2:#6cc8ff; --danger:#ff7b7b; --ok:#8dffb4;
    --radius:16px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:linear-gradient(180deg,var(--bg),var(--bg2));color:var(--text);font-family:"Inter",system-ui,Segoe UI,Arial,sans-serif}
  a{color:var(--accent2)}
  .container{max-width:1200px;margin:0 auto;padding:24px}
  header{display:flex;align-items:center;gap:16px;justify-content:space-between;margin-bottom:18px}
  .title{font-weight:800;font-size:clamp(20px,2.4vw,34px);letter-spacing:.3px}
  .subtitle{color:var(--muted);font-size:14px}
  nav{display:flex;flex-wrap:wrap;gap:8px}
  nav a{padding:10px 14px;border-radius:999px;background:#10263b;color:#d9eeff;text-decoration:none;font-weight:600;border:1px solid #183a56}
  nav a:hover{background:#15314c}

  .grid{display:grid;grid-template-columns:1.5fr 1fr;gap:16px}
  @media (max-width:980px){.grid{grid-template-columns:1fr}}

  .card{background:linear-gradient(180deg,#0c1e31,#0c2239);border:1px solid #173a5a;padding:16px;border-radius:var(--radius);box-shadow:0 10px 30px rgba(0,0,0,.25)}
  .card h2{margin:0 0 12px 0;font-size:20px}
  .muted{color:var(--muted)}

  /* PERIODICKÁ TABULKA */
  .pse-wrap{display:grid;grid-template-columns:repeat(18, minmax(28px,1fr));gap:6px}
  .el{position:relative;background:#0f2941;border:1px solid #174a70;border-radius:12px;padding:6px 4px;cursor:pointer;user-select:none;transition:transform .08s ease, background .2s}
  .el:hover{background:#143759;transform:translateY(-1px)}
  .el .Z{position:absolute;top:6px;left:6px;font-size:10px;color:#9ec7e8}
  .el .sym{display:block;font-weight:800;font-size:clamp(12px,1.6vw,18px);text-align:center;margin-top:8px}
  .el .name{display:block;font-size:10px;text-align:center;color:#b7d2eb;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .type-metal{background:#12324c}
  .type-nonmetal{background:#123d3a}
  .type-metalloid{background:#2f2f52}
  .type-noble{background:#2b3c65}
  .type-halogen{background:#274e5e}
  .type-alkali{background:#2b4d6b}
  .type-alkaline{background:#264b52}

  .details{display:grid;grid-template-columns:1.2fr 1fr;gap:12px}
  @media (max-width:900px){.details{grid-template-columns:1fr}}
  .kv{display:grid;grid-template-columns:1fr 1fr;gap:8px}
  .kv div{background:#0f2741;border:1px solid #1a476e;border-radius:12px;padding:10px}
  .badge{display:inline-block;padding:4px 8px;border-radius:999px;background:#11334d;border:1px solid #1c507a;font-size:12px;margin-right:6px;margin-top:6px}

  /* GENERÁTOR */
  .form{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:6px}
  @media (max-width:680px){.form{grid-template-columns:1fr}}
  .form input, .form select{width:100%;padding:12px 14px;border-radius:12px;border:1px solid #224f78;background:#0d243a;color:#e5f2ff;font-size:14px}
  .btn{padding:12px 16px;border-radius:12px;border:1px solid #2c8b6d;background:linear-gradient(180deg,#1f6b57,#1e7e63);color:#eafff5;font-weight:800;cursor:pointer}
  .btn:hover{filter:brightness(1.05)}
  .code{font-family:ui-monospace,SFMono-Regular,Menlo,monospace;background:#0c2136;border:1px solid #1a3a5b;border-radius:12px;padding:12px;overflow:auto}

  details summary{cursor:pointer;font-weight:700;margin:4px 0}
  .pill{display:inline-block;padding:4px 8px;border-radius:999px;background:#18324a;border:1px solid #2b547e;color:#cfe4ff;margin:2px;font-size:12px}
  .ok{color:var(--ok)} .bad{color:var(--danger)}
</style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <div class="title">Chemie — 9. třída</div>
        <div class="subtitle">Interaktivní periodická tabulka, názvosloví, příklady reakcí a chytrý generátor rovnic</div>
      </div>
      <nav>
        <a href="#pse">PSE</a>
        <a href="#anorg">Anorganika</a>
        <a href="#org">Organika</a>
        <a href="#generator">Generátor rovnic</a>
        <a href="#nazvoslovi">Názvosloví</a>
      </nav>
    </header>

    <div class="grid">
      <!-- LEVÝ SLOUPEC: PSE + detaily -->
      <section id="pse" class="card">
        <h2>Periodická soustava prvků (zkrácená demo verze)</h2>
        <div class="muted">Klikni na prvek pro detail: základní info, oxidační čísla, typické sloučeniny a ukázkové reakce.</div>
        <div id="pseGrid" class="pse-wrap" aria-label="periodická tabulka"></div>
      </section>

      <aside class="card">
        <h2>Detail prvku</h2>
        <div id="detail">
          <p class="muted">Vyber prvek v tabulce vlevo.</p>
        </div>
      </aside>
    </div>

    <div class="grid" style="margin-top:16px">
      <section id="anorg" class="card">
        <h2>Anorganická chemie — skupiny + zástupci</h2>
        <details open>
          <summary>Hydridy (kovalentní i iontové)</summary>
          <div class="rep">
            <div class="cardlite"><strong>Kovalentní:</strong> <span class="pill">NH₃</span> <span class="pill">PH₃</span> <span class="pill">CH₄</span> <span class="pill">SiH₄</span></div>
            <div class="cardlite"><strong>Iontové (alkal./zem.alk.):</strong> <span class="pill">NaH</span> <span class="pill">LiH</span> <span class="pill">CaH₂</span> — reagují s H₂O: <code>NaH + H₂O → NaOH + H₂</code></div>
          </div>
        </details>
        <details>
          <summary>Sulfidy (MX, X = S²⁻)</summary>
          <div class="rep">
            <div class="cardlite"><span class="pill">FeS</span> <span class="pill">ZnS</span> <span class="pill">CuS</span> <span class="pill">PbS</span> <span class="pill">Na₂S</span></div>
          </div>
          <p>Tvorba: <code>M + S → MS</code> (podle valence). Příklad: <code>Fe + S → FeS</code>.</p>
        </details>
        <details>
          <summary>Hydrogensulfidy a H₂S</summary>
          <p><strong>H₂S</strong>: slabá bezkyslíkatá kyselina (též sulfan / sirovodík). <strong>Hydrogensulfidy</strong>: soli HS⁻ (NaHS, KHS). <strong>Sulfidy</strong>: S²⁻ (Na₂S).</p>
          <p>Neutralizace: <code>H₂S + 2NaOH → Na₂S + 2H₂O</code>; srážení: <code>H₂S + CuSO₄ → CuS↓ + H₂SO₄</code>.</p>
        </details>
        <details>
          <summary>Kyseliny bezkyslíkaté</summary>
          <div class="rep">
            <div class="cardlite"><span class="pill">HCl</span> <span class="pill">HBr</span> <span class="pill">HI</span> <span class="pill">H₂S</span> <span class="pill">HCN</span></div>
          </div>
          <p>Pojmenování: <em>kyselina chlorovodíková, bromovodíková, jodovodíková, sirovodíková</em>…</p>
        </details>
        <details>
          <summary>Kyslíkaté kyseliny</summary>
          <div class="rep">
            <div class="cardlite"><span class="pill">H₂SO₄</span> <span class="pill">H₂SO₃</span> <span class="pill">HNO₃</span> <span class="pill">HNO₂</span> <span class="pill">H₂CO₃</span> <span class="pill">H₃PO₄</span> <span class="pill">HClO₄</span></div>
          </div>
          <p>Vznik hydratací oxidů: <code>SO₃ + H₂O → H₂SO₄</code>; <code>N₂O₅ + H₂O → 2HNO₃</code>.</p>
        </details>
        <details>
          <summary>Soli kyselin</summary>
          <div class="rep">
            <div class="cardlite"><strong>Sírany:</strong> Na₂SO₄, BaSO₄ (nes.), CuSO₄</div>
            <div class="cardlite"><strong>Dusičnany:</strong> KNO₃, AgNO₃, NH₄NO₃</div>
            <div class="cardlite"><strong>Uhličitany:</strong> Na₂CO₃, CaCO₃ (nes.), NaHCO₃</div>
            <div class="cardlite"><strong>Fosforečnany:</strong> Na₃PO₄, Ca₃(PO₄)₂</div>
            <div class="cardlite"><strong>Chloridy:</strong> NaCl, KCl, AgCl (sraž.)</div>
          </div>
        </details>
        <details>
          <summary>Halogenidy</summary>
          <div class="rep">
            <div class="cardlite"><span class="pill">NaCl</span> <span class="pill">FeCl₃</span> <span class="pill">CuCl₂</span> <span class="pill">CaF₂</span> <span class="pill">AgCl (sraž.)</span></div>
          </div>
          <p>Tvorba např.: <code>2Na + Cl₂ → 2NaCl</code>.</p>
        </details>
      </section>

      <section id="org" class="card">
        <h2>Organická chemie — přehled skupin</h2>
        <div class="rep">
          <div class="cardlite"><strong>Uhlovodíky:</strong> alkany, alkeny, alkyny, arény (benzen).</div>
          <div class="cardlite"><strong>Halogenderiváty:</strong> R–X (Cl, Br, I, F) — např. chlor Ethan (chlorethan).</div>
          <div class="cardlite"><strong>Alkoholy a fenoly:</strong> R–OH (ethanol), Ar–OH (fenol).</div>
          <div class="cardlite"><strong>Etery:</strong> R–O–R' (dietyl-ether).</div>
          <div class="cardlite"><strong>Aldehydy/ketony:</strong> ethanal, propanon (aceton).</div>
          <div class="cardlite"><strong>Karboxylové kyseliny:</strong> kys. mravenčí, octová.</div>
          <div class="cardlite"><strong>Estery:</strong> ethyl-acetát (vůně), methyl-formiát.</div>
          <div class="cardlite"><strong>Aminy:</strong> methylamin, anilin (9. třída = jen základ).</div>
          <div class="cardlite"><strong>Amidy:</strong> acetamid (pokročilejší, pro přehled).</div>
          <div class="cardlite"><strong>Nitrily:</strong> acetonitril.</div>
        </div>
        <p>U každé skupiny zvol 3–9 zástupců (základní a důležité). Generátor umí spalování alkanů a základní anorganické děje; další scénáře lze snadno přidat.</p>
      </section>
    </div>

    <section id="generator" class="card" style="margin-top:16px">
      <h2>Generátor rovnic (demo) — zadej reaktanty a typ reakce</h2>
      <div class="muted">Zatím podporuje: <strong>kov + O₂ → oxid</strong>, <strong>kov + Cl₂ → halogenid</strong>, <strong>spalování alkanu</strong>, <strong>neutralizace HCl + NaOH</strong>. Postupně snadno rozšíříš v <code>script.js</code>.</div>
      <div class="form">
        <input id="r1" placeholder="Reaktant 1 (např. Na nebo C2H6 nebo HCl)" />
        <input id="r2" placeholder="Reaktant 2 (např. O2 nebo Cl2 nebo NaOH)" />
        <select id="rtype" aria-label="typ reakce">
          <option value="auto">Automaticky rozpoznat</option>
          <option value="oxidace">Kov + O₂ → oxid</option>
          <option value="halogenace">Kov + Cl₂ → halogenid</option>
          <option value="spalovani">Spalování alkanu CxHy</option>
          <option value="neutralizace">Neutralizace HCl + NaOH</option>
        </select>
        <button class="btn" id="genBtn">Vyčísli rovnici</button>
      </div>
      <div style="margin-top:12px">
        <div class="code" id="result">Zatím nic — zadej reaktanty ⬆️</div>
      </div>
    </section>

    <section id="nazvoslovi" class="card" style="margin-top:16px">
      <h2>Názvosloví — rozšířené (CZ, 9. třída+)</h2>
      <h3>Oxidační čísla a přípony kovů</h3>
      <ul>
        <li>+I: <em>…ný</em> (CuCl = chlorid měďný)</li>
        <li>+II: <em>…natý</em> (FeO = oxid železnatý)</li>
        <li>+III: <em>…itý</em> (FeCl₃ = chlorid železitý)</li>
        <li>+IV: <em>…ičitý</em> (CO₂ = oxid uhličitý)</li>
        <li>+V: <em>…ečný/…ičný</em> (P₂O₅ → kys. fosforečná)</li>
        <li>+VI: <em>…ový</em> (SO₃ → kys. sírová)</li>
        <li>+VII: <em>…istý/…ičelý</em> (Mn₂O₇ → kys. manganistá)</li>
      </ul>
      <h3>Kyseliny</h3>
      <p>Bezkyslíkaté: HCl (kys. chlorovodíková), H₂S (kys. sirovodíková). Kyslíkaté: HNO₃ (dusičná), H₂SO₄ (sírová), H₂CO₃ (uhličitá), H₃PO₄ (fosforečná).</p>
      <h3>Soli</h3>
      <p><strong>„aniont + kationt“:</strong> Na₂SO₄ = síran sodný; CaCO₃ = uhličitan vápenatý; AgCl = chlorid stříbrný. Hydrogen-soli: NaHCO₃ (hydrogenuhličitan sodný), NaHS (hydrogensulfid sodný).</p>
      <h3>Halogenidy</h3>
      <p>NaCl = chlorid sodný; FeCl₃ = chlorid železitý; CaF₂ = fluorid vápenatý; AgCl = chlorid stříbrný (sraženina).</p>
      <h3>Organika — základ pojmenování</h3>
      <ol>
        <li>Najdi nejdelší řetězec; určuj násobné vazby (přednost).</li>
        <li>Očísluj tak, aby součet poloh byl nejmenší.</li>
        <li>Přípony: -an, -en, -yn; funkční skupiny: -ol (alkohol), -al (aldehyd), -on (keton), -ová kyselina, -át (ester), -amin (amin).</li>
        <li>Předpony: methyl-, ethyl-, chloro-, bromo-, nitro-…</li>
      </ol>
    </section>

    <footer class="muted" style="margin-top:20px;text-align:center">
      © 2025 Chemie 9. třída · Postaveno jako single‑file demo pro GitHub Pages. Snadné rozšíření do více souborů (<code>data/*.json</code>, <code>script.js</code> atd.).
    </footer>
  </div>

<script>
// =====================
// MINI DATASET PRVKŮ (ukázka – snadno rozšíříš do JSON)
// =====================
const ELEMENTS = [
  {Z:1, sym:"H", name:"Vodík", type:"nonmetal", group:1, period:1, ox:[+1,-1], mass:1.008, valences:[1]},
  {Z:6, sym:"C", name:"Uhlík", type:"nonmetal", group:14, period:2, ox:[-4,+2,+4], mass:12.011, valences:[4]},
  {Z:7, sym:"N", name:"Dusík", type:"nonmetal", group:15, period:2, ox:[-3,+3,+5], mass:14.007, valences:[3,5]},
  {Z:8, sym:"O", name:"Kyslík", type:"nonmetal", group:16, period:2, ox:[-2,-1], mass:15.999, valences:[2]},
  {Z:11, sym:"Na", name:"Sodík", type:"alkali", group:1, period:3, ox:[+1], mass:22.990, valences:[1]},
  {Z:12, sym:"Mg", name:"Hořčík", type:"alkaline", group:2, period:3, ox:[+2], mass:24.305, valences:[2]},
  {Z:13, sym:"Al", name:"Hliník", type:"metal", group:13, period:3, ox:[+3], mass:26.982, valences:[3]},
  {Z:17, sym:"Cl", name:"Chlor", type:"halogen", group:17, period:3, ox:[-1,+1,+3,+5,+7], mass:35.45, valences:[1]},
  {Z:26, sym:"Fe", name:"Železo", type:"metal", group:8, period:4, ox:[+2,+3], mass:55.845, valences:[2,3]},
  {Z:29, sym:"Cu", name:"Měď", type:"metal", group:11, period:4, ox:[+1,+2], mass:63.546, valences:[1,2]},
  {Z:30, sym:"Zn", name:"Zinek", type:"metal", group:12, period:4, ox:[+2], mass:65.38, valences:[2]},
  {Z:56, sym:"Ba", name:"Baryum", type:"alkaline", group:2, period:6, ox:[+2], mass:137.33, valences:[2]},
  {Z:3, sym:"Li", name:"Lithium", type:"alkali", group:1, period:2, ox:[+1], mass:6.94, valences:[1]},
  {Z:19, sym:"K", name:"Draslík", type:"alkali", group:1, period:4, ox:[+1], mass:39.098, valences:[1]},
  {Z:20, sym:"Ca", name:"Vápník", type:"alkaline", group:2, period:4, ox:[+2], mass:40.078, valences:[2]},
  {Z:16, sym:"S", name:"Síra", type:"nonmetal", group:16, period:3, ox:[-2,+4,+6], mass:32.06, valences:[2,4,6]},
  {Z:15, sym:"P", name:"Fosfor", type:"nonmetal", group:15, period:3, ox:[-3,+3,+5], mass:30.974, valences:[3,5]},
  {Z:2, sym:"He", name:"Helium", type:"noble", group:18, period:1, ox:[0], mass:4.0026, valences:[0]},
  {Z:10, sym:"Ne", name:"Neon", type:"noble", group:18, period:2, ox:[0], mass:20.18, valences:[0]}
];

// Rozmístění do mřížky (jednoduchý layout 18 sloupců; prázdná místa = null)
// Pouze demo – obsahuje hlavně zástupné prvky, ale zachovává typické rohové/okrajové pozice.
const PSE_LAYOUT = [
  // řádek 1 (18)
  "H", null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"He",
  // řádek 2
  "Li","Be",null,null,null,null,null,null,null,null,null,"B","C","N","O","F","Ne",
  // řádek 3
  "Na","Mg",null,null,null,null,null,null,null,null,null,"Al","Si","P","S","Cl","Ar",
  // řádek 4 (zkráceno – jen pár příkladů)
  "K","Ca","Sc","Ti","V","Cr","Mn","Fe","Co","Ni","Cu","Zn","Ga","Ge","As","Se","Br","Kr",
  // řádek 5 (placeholdery nepoužité v demu)
];

function findEl(sym){return ELEMENTS.find(e=>e.sym===sym)}

function renderPSE(){
  const grid=document.getElementById('pseGrid');
  grid.innerHTML='';
  PSE_LAYOUT.forEach(sym=>{
    if(!sym){
      const hole=document.createElement('div');
      hole.style.visibility='hidden';
      grid.appendChild(hole);return;
    }
    const e=findEl(sym);
    if(!e){
      const ghost=document.createElement('div');
      ghost.className='el';
      ghost.innerHTML='<span class="sym">'+sym+'</span>';
      grid.appendChild(ghost);return;
    }
    const el=document.createElement('div');
    el.className='el type-'+(e.type||'metal');
    el.innerHTML=`<span class="Z">${e.Z}</span><span class="sym">${e.sym}</span><span class="name">${e.name}</span>`;
    el.title=e.name;
    el.addEventListener('click',()=>showDetail(e));
    grid.appendChild(el);
  });
}

function showDetail(e){
  const d=document.getElementById('detail');
  const ox=e.ox?.join(', ');
  d.innerHTML=`
    <div class="details">
      <div>
        <h3 style="margin:0 0 8px 0">${e.name} (${e.sym})</h3>
        <div class="muted">Protonové číslo: ${e.Z} · Rel. atom. hmotnost: ${e.mass}</div>
        <div style="margin-top:10px" class="kv">
          <div><strong>Skupina</strong><br>${e.group ?? '—'}</div>
          <div><strong>Perioda</strong><br>${e.period ?? '—'}</div>
          <div><strong>Typ</strong><br>${e.type}</div>
          <div><strong>Oxidační čísla</strong><br>${ox}</div>
        </div>
        <div style="margin-top:10px">
          <span class="badge">Valence: ${e.valences?.join(', ') || '—'}</span>
        </div>
      </div>
      <div>
        <h4 style="margin:0 0 6px 0">Typické sloučeniny</h4>
        <div class="muted">Příklady (9. třída):</div>
        <ul style="margin-top:6px">
          ${exampleCompounds(e).map(x=>`<li>${x}</li>`).join('')}
        </ul>
        <h4 style="margin:8px 0 6px 0">Ukázkové reakce</h4>
        <ul>
          ${exampleReactions(e).map(x=>`<li><code>${x}</code></li>`).join('')}
        </ul>
      </div>
    </div>
  `;
}

function exampleCompounds(e){
  const s=e.sym;
  switch(s){
    case 'Na': return ['NaCl (chlorid sodný)','Na₂O (oxid sodný)','NaOH (hydroxid sodný)','Na₂SO₄ (síran sodný)']
    case 'Fe': return ['Fe₂O₃ (oxid železitý)','FeCl₃ (chlorid železitý)','FeO (oxid železnatý)']
    case 'C': return ['CO₂ (oxid uhličitý)','CH₄ (methan)','C₂H₆ (ethan)']
    case 'O': return ['H₂O (voda)','CO₂ (oxid uhličitý)','Na₂O₂ (peroxid sodný)']
    case 'Cl': return ['NaCl (chlorid sodný)','HCl (kys. chlorovodíková)','FeCl₃ (chlorid železitý)']
    default: return [e.sym+"O", e.sym+"Cl", e.sym+"(OH)ₙ – podle valence"]
  }
}
function exampleReactions(e){
  switch(e.sym){
    case 'Na': return ['2Na + Cl₂ → 2NaCl','4Na + O₂ → 2Na₂O']
    case 'Fe': return ['2Fe + 3Cl₂ → 2FeCl₃','4Fe + 3O₂ → 2Fe₂O₃']
    case 'C': return ['CH₄ + 2O₂ → CO₂ + 2H₂O']
    default: return ['M + O₂ → M₂Oₓ (podle valence)','M + Cl₂ → MClₓ']
  }
}

// =====================
// GENERÁTOR ROVNIC (první verze – pravidlový)
// =====================
const metals = new Set(['Li','Na','K','Mg','Ca','Ba','Al','Fe','Cu','Zn']);
const halogens = new Set(['F','Cl','Br','I']);

function parseFormula(f){
  // velmi jednoduchý parser jen pro vzorce bez závorek (demo)
  // vrací pole {el, n}
  const out=[]; const re=/([A-Z][a-z]?)(\d*)/g; let m;
  while((m=re.exec(f))!==null){
    const el=m[1]; const n=parseInt(m[2]||'1',10);
    out.push({el,n});
  }
  return out;
}

function gcd(a,b){ return !b?Math.abs(a):gcd(b,a%b); }
function lcm(a,b){ return Math.abs(a*b)/gcd(a,b); }

function isAlkane(form){
  // CxHy with y=2x+2
  const parsed=parseFormula(form);
  const c=parsed.find(p=>p.el==='C');
  const h=parsed.find(p=>p.el==='H');
  if(!c||!h||parsed.length>2) return false;
  return (h.n===2*c.n+2);
}

function formatEquation(lhs, rhs, coeffL=[], coeffR=[]){
  const fmt = (arr, coeff)=>arr.map((sp,i)=> (coeff[i]&&coeff[i]!==1?coeff[i]+'':'') + sp).join(' + ');
  return fmt(lhs, coeffL) + ' → ' + fmt(rhs, coeffR);
}

function genOxidation(metalSym){
  // Kov + O2 -> oxid M_a O_b podle valence (z datasetu vezmeme nejběžnější)
  const el=findEl(metalSym);
  if(!el) throw new Error('Neznámý kov');
  const val=el.valences && el.valences[0] ? el.valences[0] : 2; // zjednodušení
  // Oxidový anion má -II -> křížové pravidlo
  // M^{+val} O^{2-} => M_{2} O_{val} a zkrátíme
  let a=2, b=val;
  const g=gcd(a,b); a/=g; b/=g;
  const prod = metalSym + (a>1?a:'') + 'O' + (b>1?b:'');
  // LHS: M + O2 ; RHS: M_a O_b ; nyní vyčíslit koeficienty
  // Rovnováha prvků: M: x = a*y ; O: 2*z = b*y ; minimal solution: x=a*k, z=(b/2)*k
  // chceme celé -> zvolíme k tak, aby (b/2)*k integer => k = 2 / gcd(2,b)
  const k = 2 / gcd(2,b);
  const x = a*k; // koef u kovu
  const z = (b/2)*k; // koef u O2
  const y = k; // koef u produktu
  return {
    products:[prod],
    equation: formatEquation([metalSym,'O2'], [prod], [x,z], [y]),
    steps:[
      `Valence kovu ~ ${val}, kyslík −II → vzorec oxidu ${prod} (křížové pravidlo).`,
      `Vyčíslení: ${metalSym}: ${x} → ${a*y}; O: ${2*z} → ${b*y}.`]
  };
}

function genHalogenide(metalSym, hal='Cl'){
  const el=findEl(metalSym); if(!el) throw new Error('Neznámý kov');
  const val=el.valences?.[0]||1;
  const an=1; // Cl−
  let a=an, b=val; // M^{+b} X^{−a} → M_a X_b (křížem)
  const g=gcd(a,b); a/=g; b/=g;
  const prod = metalSym + (a>1?a:'') + hal + (b>1?b:'');
  // Vyčíslení: M + X2 -> M_aX_b
  // X: 2*z = b*y ; M: x = a*y
  // Vyber y tak, aby b*y sudé → y = 2/gcd(2,b)
  const y = 2 / gcd(2,b);
  const x = a*y; const z = (b*y)/2;
  return {
    products:[prod],
    equation: formatEquation([metalSym, hal+'2'], [prod], [x, z], [y]),
    steps:[
      `Valence kovu ~ ${val}, halogen −I → vzorec halogenidu ${prod}.`,
      `Vyčíslení podle počtu atomů halogenu (X₂) a kovu.`]
  };
}

function genCombustion(form){
  // Spalování alkanu CxHy: CxHy + O2 -> CO2 + H2O (vyčíslení celočíselně)
  const p=parseFormula(form);
  const c=p.find(x=>x.el==='C')?.n||0;
  const h=p.find(x=>x.el==='H')?.n||0;
  if(!(c>=1 && h===2*c+2)) throw new Error('Není to alkan CxH2x+2');
  // Rovnice: CcHh + O2 -> c CO2 + (h/2) H2O ; O2 koef = (2c + (h/2)) / 2
  let a=1; let b=2*c + (h/2); // kyslíky v produktech
  let o2 = b/2;
  // Zajistíme celá čísla: pokud h je liché? U alkanů h=2c+2 vždy sudé; o2 může být .5 → násobíme vše 2
  if(o2%1!==0){ a*=2; o2*=2; }
  const co2 = c*a; const h2o = (h/2)*a;
  return {
    products:['CO2','H2O'],
    equation: formatEquation([form,'O2'], ['CO2','H2O'], [a, o2], [co2, h2o]),
    steps:[
      `Uhlík: ${c} → ${co2} v CO₂; Vodík: ${h} → ${h2o*2} v H₂O; dopočítán kyslík.`]
  };
}

function genNeutralization(){
  // Jednoduchá ukázka: HCl + NaOH -> NaCl + H2O (již vyčísleno 1:1:1:1)
  return {
    products:['NaCl','H2O'],
    equation:'HCl + NaOH → NaCl + H₂O',
    steps:['Silná kyselina + silná zásada → sůl a voda (neutralizace).']
  }
}

function autoDetect(r1, r2){
  // heuristika
  const A=r1.trim(), B=r2.trim();
  if(!A||!B) throw new Error('Zadej oba reaktanty');
  // Kov + O2
  if(metals.has(A) && B==='O2') return ['oxidace', A];
  if(metals.has(B) && A==='O2') return ['oxidace', B];
  // Kov + Cl2
  if(metals.has(A) && B==='Cl2') return ['halogenace', A, 'Cl'];
  if(metals.has(B) && A==='Cl2') return ['halogenace', B, 'Cl'];
  // Spalování alkanu
  if(B==='O2' && isAlkane(A)) return ['spalovani', A];
  if(A==='O2' && isAlkane(B)) return ['spalovani', B];
  // Neutralizace specifická dvojice
  if((A==='HCl'&&B==='NaOH')||(A==='NaOH'&&B==='HCl')) return ['neutralizace'];
  throw new Error('Tento typ reakce zatím neumím automaticky. Zkus přepnout typ reakce.');
}

function handleGenerate(){
  const r1=document.getElementById('r1').value.trim();
  const r2=document.getElementById('r2').value.trim();
  const type=document.getElementById('rtype').value;
  const out=document.getElementById('result');
  try{
    let data;
    if(type==='auto'){
      const det=autoDetect(r1,r2);
      if(det[0]==='oxidace') data=genOxidation(det[1]);
      else if(det[0]==='halogenace') data=genHalogenide(det[1], det[2]||'Cl');
      else if(det[0]==='spalovani') data=genCombustion(det[1]);
      else if(det[0]==='neutralizace') data=genNeutralization();
    } else if(type==='oxidace'){
      const metal = metals.has(r1)?r1 : metals.has(r2)?r2 : null;
      if(!metal) throw new Error('Zadej kov (např. Na, Fe) a O2.');
      data=genOxidation(metal);
    } else if(type==='halogenace'){
      const metal = metals.has(r1)?r1 : metals.has(r2)?r2 : null;
      if(!metal) throw new Error('Zadej kov (např. Na) a Cl2.');
      data=genHalogenide(metal,'Cl');
    } else if(type==='spalovani'){
      const alk = isAlkane(r1)?r1 : isAlkane(r2)?r2 : null;
      if(!alk) throw new Error('Zadej alkan CxH2x+2 a O2.');
      data=genCombustion(alk);
    } else if(type==='neutralizace'){
      data=genNeutralization();
    }

    out.innerHTML = `<div><strong>Vyčíslená rovnice:</strong><br>${data.equation}</div>
    <div style="margin-top:8px"><strong>Produkty:</strong> ${data.products.join(', ')}</div>
    <div style="margin-top:8px"><strong>Postup:</strong><ol>${data.steps.map(s=>`<li>${s}</li>`).join('')}</ol></div>`;
  }catch(err){
    out.innerHTML = `<span class="bad">${err.message}</span>`;
  }
}

document.getElementById('genBtn').addEventListener('click', handleGenerate);
renderPSE();
</script>
</body>
</html>
